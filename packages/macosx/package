#!/bin/sh

# Compilation
rm -rf qRezix.app
echo "Building qRezix"
cd ../..
./build-mac > /dev/null

# Ajout de Qt dans le bundle
echo "Linking with Qt"
cd packages/macosx
cp $QTDIR/lib/QtGui.framework/QtGui qRezix.app/Contents/Frameworks/
cp $QTDIR/lib/QtCore.framework/QtCore qRezix.app/Contents/Frameworks/
cp $QTDIR/lib/QtNetwork.framework/QtNetwork qRezix.app/Contents/Frameworks/

cd qRezix.app/Contents
../../install_libs MacOS/qRezix
../../install_libs Frameworks/QtGui
../../install_libs Frameworks/QtCore
../../install_libs Frameworks/QtNetwork
find . -name '*.dylib' -exec ../../install_libs {} ";"

# Nettoyage du bundle
echo "Cleaning the bundle"
cd Resources
find . -name '.svn' -exec rm -rf {} ";" 2> /dev/null > /dev/null
rm -rf icones
rm -rf logs

# Restauration des liens symboliques
cd ../Frameworks
rm libqrezix.2.0.dylib
rm libqrezix.2.dylib
rm libqrezix.dylib
ln -s libqrezix.2.0.1.dylib libqrezix.2.0.dylib
ln -s libqrezix.2.0.1.dylib libqrezix.2.dylib
ln -s libqrezix.2.0.1.dylib libqrezix.dylib
