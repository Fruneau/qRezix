#!/usr/bin/make -f
# Made with the aid of debmake, by Christoph Lameter,
# based on the sample debian/rules file for GNU hello by Ian Jackson.

package=qrezix

build: 	checkdir 
	# On commence par compiler
	qmake-qt4 "PREFIX=/usr" "DEST=$(CURDIR)/debian/qrezix" -o Makefile qrezix.pro
	$(MAKE) 
	# On relance la génération du Makefile pour le make install
	
	qmake-qt4 "PREFIX=/usr" "DEST=$(CURDIR)/debian/qrezix" -o Makefile qrezix.pro
	$(MAKE) install
	
	#Installation des libs
	#Modules reseau
	#mv $(CURDIR)/debian/qrezix-bin/usr/lib/librzxnet* $(CURDIR)/debian/qrezix-bin/usr/lib/qrezix/net
	#Modules
	#mv $(CURDIR)/debian/qrezix-bin/usr/lib/librzx*.so*  $(CURDIR)/debian/qrezix-bin/usr/lib/qrezix/modules
	
	#Installation des binaires
	#mkdir -p $(CURDIR)/debian/qrezix-bin/usr/bin
	#cp -a qrezix/qrezix $(CURDIR)/debian/qrezix-bin/usr/bin
	
	#qMake ne gère pas les liens symboliques lors de l'install, ce qui rend le système pas très bon, alors on fait la copie à sa place
	rm $(CURDIR)/debian/qrezix/usr/lib/libqrezix.so*
	cp -a $(CURDIR)/libqrezix.so* $(CURDIR)/debian/qrezix/usr/lib/
	
	# Paquets séparés pour les Traductions
	mkdir -p $(CURDIR)/debian/qrezix-translations-fr/usr/share/qrezix/translations/
	mv $(CURDIR)/debian/qrezix/usr/share/qrezix/translations/*.qm $(CURDIR)/debian/qrezix-translations-fr/usr/share/qrezix/translations/
	
	# Paquets séparés pour les thèmes
	mkdir -p $(CURDIR)/debian/qrezix-theme-noia-warm/usr/share/qrezix/themes/NoiaWarmKDE
	cp -a $(CURDIR)/debian/qrezix/usr/share/qrezix/themes/NoiaWarmKDE/*.png $(CURDIR)/debian/qrezix-theme-noia-warm/usr/share/qrezix/themes/NoiaWarmKDE
	mkdir -p $(CURDIR)/debian/qrezix-theme-krystal/usr/share/qrezix/themes/krystal
	cp -a $(CURDIR)/debian/qrezix/usr/share/qrezix/themes/Krystal/*.png $(CURDIR)/debian/qrezix-theme-krystal/usr/share/qrezix/themes/krystal
	mkdir -p $(CURDIR)/debian/qrezix-theme-macosx/usr/share/qrezix/themes/MacOSX
	cp -a $(CURDIR)/debian/qrezix/usr/share/qrezix/themes/MacOSX/*.png $(CURDIR)/debian/qrezix-theme-macosx/usr/share/qrezix/themes/MacOSX
	mkdir -p $(CURDIR)/debian/qrezix-theme-kids/usr/share/qrezix/themes/Kids
	cp -a $(CURDIR)/debian/qrezix/usr/share/qrezix/themes/Kids/*.png $(CURDIR)/debian/qrezix-theme-kids/usr/share/qrezix/themes/Kids
	mkdir -p $(CURDIR)/debian/qrezix-theme-classic/usr/share/qrezix/themes/classic
	cp -a $(CURDIR)/debian/qrezix/usr/share/qrezix/themes/Classic/*.png $(CURDIR)/debian/qrezix-theme-classic/usr/share/qrezix/themes/classic
	mkdir -p $(CURDIR)/debian/qrezix-theme-ms/usr/share/qrezix/themes/ms
	cp -a $(CURDIR)/debian/qrezix/usr/share/qrezix/themes/ms/*.png $(CURDIR)/debian/qrezix-theme-ms/usr/share/qrezix/themes/ms
	rm -rf $(CURDIR)/debian/qrezix/usr/share/qrezix/themes
	
	#Paquet de headers
	mkdir -p $(CURDIR)/debian/qrezix-dev/usr/include/qrezix
	cp -a $(CURDIR)/core/Rzx* $(CURDIR)/debian/qrezix-dev/usr/include/qrezix
	cp -a $(CURDIR)/core/*.h $(CURDIR)/debian/qrezix-dev/usr/include/qrezix
	
	#Fin du build
	touch build

checkdir:
	$(checkdir)
	touch checkdir


clean:
	if test -f Makefile; then\
		make distclean;\
	fi
	dh_clean -k -A
	rm -f build
	rm -f checkdir 

binary-indep: checkroot build
	$(checkdir)

	#dh_install 
# There are no architecture-independent files to be uploaded
# generated by this package.  If there were any they would be
# made here.

binary-arch: checkroot build
	dh_testdir
	dh_testroot
	dh_installchangelogs
	#dh_installdocs
	dh_installdocs -A ChangeLog README AUTHORS COPYING TODO
	#dh_installexamples
	#dh_installmenu
	#dh_installdebconf
	#dh_installlogrotate
	#dh_installemacsen
	#dh_installpam
	#dh_installmime
	#dh_installinit
	#dh_installcron
	#dh_installinfo
	#dh_installman
	dh_strip
	dh_link usr/lib/modules/* usr/lib
	#dh_compress -X.docbook -X.css -X-license -X.dcl -X.bz2
	dh_fixperms
	dh_makeshlibs -V
	dh_installdeb
	#dh_perl
	dh_shlibdeps -ldebian/ark/usr/lib:debian/ksim/usr/lib:debian/klaptopdaemon/usr/lib:debian/kmilo/usr/lib:debian/qrezix/usr/lib
	dh_undocumented -A qrezix.1
	dh_gencontrol
	dh_md5sums
	#chmod 755 debian/qrezix-bin/usr/lib/libqrezix*
	#chmod 755 debian/qrezix-bin/usr/lib/qrezix/*
	dh_builddeb

	
define checkdir
	test -f debian/rules
endef

binary: binary-indep binary-arch

checkroot:
	$(checkdir)
	test root = "`whoami`"

.PHONY: binary binary-arch binary-indep clean checkroot
